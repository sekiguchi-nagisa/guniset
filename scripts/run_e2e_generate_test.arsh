#!/usr/bin/env arsh

source ./e2e_helper.arsh

test -x $1 || { echo 1>&2 require guniset executable: $1; exit 1; }
let bin = $1.realpath()

cd $SCRIPT_DIR/..  # move to project top

var targets = @(./test/generate/*/)

exit $run_e2e($targets, function(op: String, target: String)=> {
    let opt = $target.endsWith("_bmp") ? "bmp" : $target.endsWith("_nonbmp") ? "non-bmp" : "all"
    "$(call $bin generate --filter=$opt -- $op)"
})